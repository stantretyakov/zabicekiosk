# ODP Local Development Environment Configuration
# Copy this file to .env and adjust values as needed

# ============================================================================
# EVENT BUS CONFIGURATION
# ============================================================================
# Local dev uses Redis, production uses Apache Pulsar
EVENT_BUS=redis
# REDIS_URL=redis://localhost:16379

# TODO (Post-MVP): Enable for production
# EVENT_BUS=pulsar
# PULSAR_URL=pulsar://localhost:16650

# ============================================================================
# AUTHENTICATION MODE
# ============================================================================
# Local dev uses trust-all mode (no authentication)
AUTH_MODE=none

# TODO (Post-MVP): Enable Keycloak for production
# AUTH_MODE=keycloak
# KEYCLOAK_URL=http://localhost:8080
# KEYCLOAK_REALM=odp
# KEYCLOAK_CLIENT_ID=odp-client
# KEYCLOAK_CLIENT_SECRET=<secret>

# ============================================================================
# LLM / FOUNDATION MODEL CONFIGURATION
# ============================================================================
# OpenAI-compatible endpoint for LLM inference
# Local dev: Use external API (Groq, OpenAI, or local Ollama/LiteLLM)
LLM_API_URL=http://localhost:4000
LLM_API_KEY=

# Alternative: Groq (faster, cheaper)
# LLM_API_URL=https://api.groq.com/openai/v1
# LLM_API_KEY=<groq-key>

# Alternative: Local Ollama (privacy requirement Q1 2026)
# LLM_API_URL=http://localhost:11434/v1
# LLM_API_KEY=  # Not required for Ollama

# Model selection
LLM_MODEL=qwen3:0.6b
# LLM_MODEL=llama3-70b-8192  # Groq

# ============================================================================
# OBJECT STORAGE (S3-COMPATIBLE)
# ============================================================================
# Local dev uses MinIO, production uses GCS
AWS_ACCESS_KEY_ID=minioadmin
AWS_SECRET_ACCESS_KEY=minioadmin
AWS_ENDPOINT_URL=http://localhost:19000
AWS_REGION=us-east-1

# Delta Lake paths (S3A protocol)
BRONZE_PATH=s3a://bronze
SILVER_PATH=s3a://silver
GOLD_PATH=s3a://gold

# TODO (Production): GCS configuration
# AWS_ACCESS_KEY_ID=<gcs-hmac-key-id>
# AWS_SECRET_ACCESS_KEY=<gcs-hmac-secret>
# AWS_ENDPOINT_URL=https://storage.googleapis.com
# BRONZE_PATH=gs://production-bronze
# SILVER_PATH=gs://production-silver
# GOLD_PATH=gs://production-gold

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL (Temporal + Accounts)
POSTGRES_HOST=localhost
POSTGRES_PORT=15432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=temporal

# MongoDB (Pipeline Storage)
MONGO_HOST=localhost
MONGO_PORT=15017
MONGO_USER=odp
MONGO_PASSWORD=odp
MONGO_DB=pipelines

# Neo4j (Graph Database - full profile only)
NEO4J_URI=bolt://localhost:17687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password123

# ============================================================================
# SERVICE PORTS (NON-STANDARD 15xxx-19xxx RANGE)
# ============================================================================
# These ports are used by docker-compose.yml
# Change only if conflicts exist (rare)

# Database Layer (15xxx)
PORT_POSTGRES=15432
PORT_MONGODB=15017
PORT_NEO4J_BOLT=17687
PORT_NEO4J_HTTP=17474

# Event/Cache Layer (16xxx)
PORT_REDIS=16379
PORT_QDRANT_HTTP=16333
PORT_QDRANT_GRPC=16334

# Temporal Cluster (17xxx)
PORT_TEMPORAL_GRPC=17233
PORT_TEMPORAL_UI=18088

# Application Services (18xxx)
PORT_USER_API=18080
PORT_YAML_PROCESSOR=18082
PORT_AGENT_ORCHESTRATOR=18083
PORT_CATALOG_STUB=18090
PORT_STUBS=18086
PORT_DAGSTER_WEB=18084
PORT_DAGSTER_GRPC=18085
PORT_MLFLOW=18087

# Storage (19xxx)
PORT_MINIO_API=19000
PORT_MINIO_CONSOLE=19001

# ============================================================================
# TEMPORAL CONFIGURATION
# ============================================================================
TEMPORAL_HOST=localhost:17233
TEMPORAL_NAMESPACE=default
TEMPORAL_TASK_QUEUE=odp-tasks

# ============================================================================
# DATA CATALOG CONFIGURATION
# ============================================================================
# Local dev uses JSON stub, production uses OpenMetadata
DATA_CATALOG=stub
CATALOG_URL=http://localhost:18090

# TODO (Post-MVP): OpenMetadata configuration
# DATA_CATALOG=openmetadata
# CATALOG_URL=http://localhost:8585

# ============================================================================
# OBSERVABILITY CONFIGURATION
# ============================================================================
# Local dev: console logs only
# Production: full observability stack
LOG_LEVEL=INFO
LOG_FORMAT=json

# TODO (Production): Prometheus, Grafana, Loki
# PROMETHEUS_URL=http://localhost:19090
# GRAFANA_URL=http://localhost:13000
# LOKI_URL=http://localhost:13100

# ============================================================================
# DAGSTER CONFIGURATION
# ============================================================================
DAGSTER_POSTGRES_USER=postgres
DAGSTER_POSTGRES_PASSWORD=postgres
DAGSTER_POSTGRES_DB=dagster
DAGSTER_POSTGRES_HOST=localhost
DAGSTER_POSTGRES_PORT=15432

# ============================================================================
# MLFLOW CONFIGURATION
# ============================================================================
MLFLOW_TRACKING_URI=http://localhost:18087
MLFLOW_S3_ENDPOINT_URL=http://localhost:19000
MLFLOW_BACKEND_STORE_URI=postgresql://postgres:postgres@localhost:15432/mlflow
MLFLOW_DEFAULT_ARTIFACT_ROOT=s3://mlflow/

# ============================================================================
# QDRANT CONFIGURATION (FULL PROFILE)
# ============================================================================
QDRANT_HOST=localhost
QDRANT_PORT=16333
QDRANT_GRPC_PORT=16334
QDRANT_API_KEY=  # Not required for local dev

# ============================================================================
# WORKSPACE CONFIGURATION
# ============================================================================
# Default workspace for testing
DEFAULT_WORKSPACE_ID=workspace-test-001
DEFAULT_PROJECT_ID=project-test-001

# ============================================================================
# EXECUTION CONFIGURATION
# ============================================================================
# Pipeline execution defaults
DEFAULT_EXECUTION_MODE=safe  # safe (approval required) or brave (autonomous)
DEFAULT_TIMEOUT_MINUTES=120
MAX_CONCURRENT_PIPELINES=100

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
# API rate limiting (requests per minute)
RATE_LIMIT_USER_API=60
RATE_LIMIT_EXTERNAL_API=100

# CORS allowed origins (comma-separated)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# ============================================================================
# DEVELOPMENT FLAGS
# ============================================================================
# Enable debug logging
DEBUG=false

# Enable hot reload (service auto-restart on code changes)
HOT_RELOAD=true

# Enable API documentation (Swagger UI)
ENABLE_API_DOCS=true

# Skip authentication checks (local dev only)
SKIP_AUTH=true

# Mock external APIs (use stubs instead of real APIs)
MOCK_EXTERNAL_APIS=true

# ============================================================================
# PROFILE SELECTION
# ============================================================================
# Profile selection for docker-compose
# Options: minimal, dev, full
COMPOSE_PROFILES=dev

# ============================================================================
# RESOURCE LIMITS (FOR DOCKER COMPOSE)
# ============================================================================
# Adjust based on available system resources
POSTGRES_MAX_CONNECTIONS=100
REDIS_MAX_MEMORY=256mb
TEMPORAL_MEMORY_LIMIT=2g
DAGSTER_MEMORY_LIMIT=2g

# ============================================================================
# EXPERIMENTAL FEATURES
# ============================================================================
# Enable experimental features (use at your own risk)
EXPERIMENTAL_PULSAR_INTEGRATION=false
EXPERIMENTAL_BENTOML_SERVING=false
EXPERIMENTAL_OPENMETADATA_CATALOG=false

# ============================================================================
# TROUBLESHOOTING
# ============================================================================
# Increase these if experiencing timeouts
HEALTHCHECK_TIMEOUT=30
STARTUP_WAIT_TIMEOUT=120

# Enable verbose logging for specific services
VERBOSE_TEMPORAL=false
VERBOSE_DAGSTER=false
VERBOSE_USER_API=false
