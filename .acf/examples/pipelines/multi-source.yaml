# Multi-Source Investigation Example
# Comprehensive OSINT investigation across multiple platforms

version: "1.0"
pipeline_id: "multi-source-investigation"
name: "Multi-Platform Social Media Investigation"
workspace_id: "workspace-test-001"
project_id: "project-test-001"

execution:
  mode: "safe"  # Requires user approval
  timeout_minutes: 60
  estimated_cost_units: 20
  estimated_duration_minutes: 10

steps:
  # Data Collection Phase
  - id: "collect_twitter"
    type: "crawler"
    method: "crawler_twitter_profile"
    retry_policy:
      max_attempts: 3
      backoff: exponential
      max_backoff_seconds: 60
    inputs:
      username:
        from: "alice_crypto"
    outputs:
      profile: "twitter_data"

  - id: "collect_facebook"
    type: "crawler"
    method: "crawler_facebook_profile"
    inputs:
      user_id:
        from: "fb_alice_crypto_123"
    outputs:
      profile: "facebook_data"

  - id: "collect_linkedin"
    type: "crawler"
    method: "crawler_linkedin_profile"
    inputs:
      profile_url:
        from: "https://linkedin.com/in/alice-crypto"
    outputs:
      profile: "linkedin_data"

  # ML Processing Phase
  - id: "recognize_faces"
    type: "ml_model"
    model: "face_recognition_v3"
    inputs:
      images:
        from: ["{{collect_twitter.profile_picture}}"]
    outputs:
      face_embeddings: "face_vectors"
    depends_on: ["collect_twitter", "collect_facebook"]
    resources:
      gpu: 1
      memory: "8Gi"

  - id: "analyze_sentiment"
    type: "ml_model"
    model: "sentiment_analysis_v1"
    inputs:
      texts:
        from: "{{collect_twitter.recent_posts[*].text}}"
    outputs:
      sentiment_scores: "sentiment_results"
    depends_on: ["collect_twitter"]

  - id: "extract_entities"
    type: "ml_model"
    model: "ner_v1"
    inputs:
      texts:
        from: "{{collect_twitter.recent_posts[*].text}}"
    outputs:
      entities: "extracted_entities"
    depends_on: ["collect_twitter"]

  # Data Enrichment Phase
  - id: "check_breach_data"
    type: "function"
    method: "breach_db_lookup"
    inputs:
      email:
        from: "alice.crypto@example.com"
    outputs:
      breaches: "breach_records"

  # Validation Phase
  - id: "validate_results"
    type: "validation"
    checks:
      relevance:
        enabled: true
        threshold: 0.8
      completeness:
        enabled: true
        threshold: 0.7
    depends_on: ["extract_entities", "check_breach_data"]

  # Output Generation
  - id: "generate_report"
    type: "output"
    format: "pdf_report"
    template: "comprehensive_investigation_v1"
    depends_on: ["validate_results"]
