# üèóÔ∏è –†–∞–±–æ—Ç–∞ —Å lean-architect: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

## üìñ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç lean-architect?

**lean-architect** - —ç—Ç–æ –∞–≥–µ–Ω—Ç-–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü–∏—à–µ—Ç Architecture Decision Records (ADR)
- ‚úÖ –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- ‚ùå –ù–ï –ø–∏—à–µ—Ç –∫–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—ç—Ç–æ –¥–µ–ª–∞—é—Ç typescript-engineer, react-engineer)

---

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å lean-architect?

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:
1. **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è** - –≤—ã–±–æ—Ä –º–µ–∂–¥—É —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏
3. **API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
4. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** - –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

### –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:
- –ù–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞ ‚Üí typescript-engineer, react-engineer
- –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö ‚Üí database-engineer
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–ø–ª–æ—è ‚Üí devops
- –ù–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ ‚Üí test-engineer

---

## üí¨ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å)

**–í—ã –ø–∏—à–µ—Ç–µ:**
```
–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Å–∏—Å—Ç–µ–º—É –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç—ã –¥–ª—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Stripe.
–ù—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ webhook'–æ–≤.
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—Å—Ç lean-architect:**
```
üìÑ docs/architecture/payment-system.md
‚îú‚îÄ –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
‚îú‚îÄ –î–∏–∑–∞–π–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (core-api —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
‚îú‚îÄ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç (OpenAPI –¥–ª—è /api/payments)
‚îú‚îÄ –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö Firestore (collections: payments, subscriptions)
‚îú‚îÄ –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Client ‚Üí API ‚Üí Stripe)
‚îú‚îÄ –°–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ –ü–ª–∞–Ω —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

üìÑ docs/architecture/adr/ADR-003-stripe-for-payments.md
‚îú‚îÄ –°—Ç–∞—Ç—É—Å: –ü—Ä–∏–Ω—è—Ç–æ
‚îú‚îÄ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ—à–µ–Ω–∏—è
‚îú‚îÄ –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ Stripe
‚îú‚îÄ –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è (–ø–ª—é—Å—ã/–º–∏–Ω—É—Å—ã)
‚îî‚îÄ –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (PayPal, Square)

üìÑ services/core-api/openapi-payment-extension.yaml
‚îî‚îÄ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö endpoints
```

---

### –ü—Ä–∏–º–µ—Ä 2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (ADR)

**–í—ã –ø–∏—à–µ—Ç–µ:**
```
–ú–Ω–µ –Ω—É–∂–µ–Ω ADR: –≤—ã–±—Ä–∞—Ç—å –º–µ–∂–¥—É —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –≤ Firestore
–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–π PostgreSQL –±–∞–∑–µ. –£—á—Ç–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 10k –∫–ª–∏–µ–Ω—Ç–æ–≤.
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—Å—Ç lean-architect:**
```
üìÑ docs/architecture/adr/ADR-004-firestore-vs-postgresql-passes.md

# ADR-004: Firestore –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤

## –°—Ç–∞—Ç—É—Å: –ü—Ä–∏–Ω—è—Ç–æ

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–°–∏—Å—Ç–µ–º–∞ zabicekiosk —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ (passes).
–¢–µ–∫—É—â–∏–π —Å—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Firestore –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö.
–†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ PostgreSQL –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

## –†–µ—à–µ–Ω–∏–µ
–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Firestore –¥–ª—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤.

## –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
**–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ —Å—Ç–µ–∫–æ–º (–≤—Å—ë –Ω–∞ Firebase)
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ kiosk-pwa –±–µ–∑ polling
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 10k+ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Firebase Security Rules
- Offline-first –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–∏–æ—Å–∫–∞

**–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ç–æ–∏–º–æ—Å—Ç—å reads –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (~$0.06 –∑–∞ 100k reads)
- –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 500 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
1. **PostgreSQL –Ω–∞ Cloud SQL**
   - –ü–ª—é—Å: –°–ª–æ–∂–Ω—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã
   - –ú–∏–Ω—É—Å: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–µ—Ç real-time –∏–∑ –∫–æ—Ä–æ–±–∫–∏
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$25/–º–µ—Å—è—Ü –∑–∞ db-f1-micro

2. **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥** (Firestore –¥–ª—è passes, PostgreSQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
   - –ü–ª—é—Å: Best of both worlds
   - –ú–∏–Ω—É—Å: –°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –¥–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø—Ä–∞–≤–¥—ã

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
- Latency < 200ms –¥–ª—è —á—Ç–µ–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö kiosk-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –°—Ç–æ–∏–º–æ—Å—Ç—å < $50/–º–µ—Å—è—Ü –ø—Ä–∏ 10k –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤

## –ü–µ—Ä–µ—Å–º–æ—Ç—Ä
–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ—à–µ–Ω–∏–µ –µ—Å–ª–∏:
- –û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—Å–∏—Ç 1M –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤
- –ü–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–æ–∂–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- –°—Ç–æ–∏–º–æ—Å—Ç—å Firestore –ø—Ä–µ–≤—ã—Å–∏—Ç $200/–º–µ—Å—è—Ü
```

---

### –ü—Ä–∏–º–µ—Ä 3: API –∫–æ–Ω—Ç—Ä–∞–∫—Ç (OpenAPI)

**–í—ã –ø–∏—à–µ—Ç–µ:**
```
–°–æ–∑–¥–∞–π OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è API —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–∏–π.
Endpoints: —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é, –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫, –æ—Ç–º–µ–Ω–∏—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—Å—Ç lean-architect:**
```yaml
üìÑ services/booking-api/openapi.yaml (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

paths:
  /api/v1/sessions:
    get:
      summary: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
      tags: [Sessions]
      parameters:
        - name: date
          in: query
          schema:
            type: string
            format: date
        - name: status
          in: query
          schema:
            type: string
            enum: [scheduled, cancelled, completed]
      responses:
        200:
          description: –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Session'

    post:
      summary: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
      tags: [Sessions]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [dateTime, capacity, instructorId]
              properties:
                dateTime:
                  type: string
                  format: date-time
                capacity:
                  type: integer
                  minimum: 1
                  maximum: 20
                instructorId:
                  type: string
                notes:
                  type: string
      responses:
        201:
          description: –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        400:
          description: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        409:
          description: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

  /api/v1/sessions/{sessionId}:
    delete:
      summary: –û—Ç–º–µ–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é
      tags: [Sessions]
      security:
        - bearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: –°–µ—Å—Å–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞
        404:
          description: –°–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
        409:
          description: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å (–µ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)

  /api/v1/sessions/{sessionId}/availability:
    get:
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ—Å—Ç
      tags: [Sessions]
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessionId:
                    type: string
                  capacity:
                    type: integer
                  booked:
                    type: integer
                  available:
                    type: integer
                  isAvailable:
                    type: boolean

components:
  schemas:
    Session:
      type: object
      properties:
        id:
          type: string
        dateTime:
          type: string
          format: date-time
        capacity:
          type: integer
        booked:
          type: integer
        instructorId:
          type: string
        status:
          type: string
          enum: [scheduled, cancelled, completed]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
```

---

### –ü—Ä–∏–º–µ—Ä 4: –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–í—ã –ø–∏—à–µ—Ç–µ:**
```
–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Å–∏—Å—Ç–µ–º—É real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è zabicekiosk:
- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ parent-web (–±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ)
- SMS —á–µ—Ä–µ–∑ Twilio –∑–∞ 24—á –¥–æ –∑–∞–Ω—è—Ç–∏—è
- Email –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –≤ admin-portal
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫

–£—á—Ç–∏ Firebase Functions, Firestore triggers, –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—Å—Ç lean-architect:**
```
üìÑ docs/architecture/notification-system.md

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π zabicekiosk

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –†–æ–¥–∏—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–Ω—è—Ç–∏—è—Ö (push, SMS, email)
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö
- –ü–æ–ª–Ω—ã–π audit trail –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –°—Ç–µ–∫: Firebase Functions, Firestore, Twilio, SendGrid
- –ú–∞—Å—à—Ç–∞–±: –î–æ 1000 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π/–¥–µ–Ω—å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
- Latency: Email/SMS <30 —Å–µ–∫—É–Ω–¥, Push <5 —Å–µ–∫—É–Ω–¥

## 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 2.1. Services
- **notification-service** (–Ω–æ–≤–∞—è Firebase Function)
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ (Twilio, SendGrid, FCM)
  - Retry –ª–æ–≥–∏–∫–∞ –∏ error handling

- **notification-scheduler** (–Ω–æ–≤–∞—è Firebase Function)
  - Cloud Scheduler —Ç—Ä–∏–≥–≥–µ—Ä (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
  - –ü–æ–∏—Å–∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–µ—Å—Å–∏–π
  - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏

### 2.2. Firestore Collections
```javascript
notifications/
  {notificationId}/
    - type: 'push' | 'sms' | 'email'
    - recipientId: string (userId)
    - templateId: string
    - scheduledAt: timestamp
    - status: 'pending' | 'sent' | 'failed'
    - sentAt?: timestamp
    - error?: string
    - metadata: {
        sessionId?: string,
        bookingId?: string
      }

notificationTemplates/
  {templateId}/
    - type: 'push' | 'sms' | 'email'
    - subject?: string (–¥–ª—è email)
    - body: string (—Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ {{name}})
    - locale: 'cs' | 'en'

notificationPreferences/
  {userId}/
    - enablePush: boolean
    - enableSms: boolean
    - enableEmail: boolean
    - smsReminderHours: number (24 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    - emailReminderHours: number (24 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```

## 3. API –ö–æ–Ω—Ç—Ä–∞–∫—Ç

### OpenAPI Specification
```yaml
paths:
  /api/v1/notifications:
    post:
      summary: –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [type, recipientId, templateId]

  /api/v1/notifications/{notificationId}:
    get:
      summary: –°—Ç–∞—Ç—É—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

  /api/v1/users/{userId}/preferences:
    get:
      summary: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    put:
      summary: –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

## 4. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Session Reminder Flow
```
Cloud Scheduler (*/5 * * * *)
    ‚Üì
notification-scheduler Function
    ‚Üì
    ‚îÇ Query Firestore: sessions where
    ‚îÇ dateTime between NOW+23h and NOW+25h
    ‚îÇ AND status = 'scheduled'
    ‚Üì
For each session:
    ‚îÇ Query bookings for session
    ‚îÇ For each booking:
    ‚îÇ   ‚Üì
    ‚îÇ   Check notificationPreferences/{userId}
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ If enableSms:
    ‚îÇ   ‚îÇ   ‚Üí Create notifications/{id} (type: sms)
    ‚îÇ   ‚îÇ If enableEmail:
    ‚îÇ   ‚îÇ   ‚Üí Create notifications/{id} (type: email)
    ‚îÇ   ‚îÇ If enablePush:
    ‚îÇ   ‚îÇ   ‚Üí Create notifications/{id} (type: push)
    ‚Üì
notifications/{id} created (Firestore onCreate trigger)
    ‚Üì
notification-service Function
    ‚Üì
    ‚îÇ Read template from notificationTemplates/
    ‚îÇ Interpolate placeholders ({{name}}, {{sessionTime}})
    ‚Üì
Switch by type:
    ‚îÇ
    ‚îú‚îÄ SMS:
    ‚îÇ   ‚îî‚îÄ Twilio API: POST /Messages
    ‚îÇ       ‚Üì
    ‚îÇ       Update notifications/{id}: status='sent', sentAt=NOW
    ‚îÇ
    ‚îú‚îÄ Email:
    ‚îÇ   ‚îî‚îÄ SendGrid API: POST /mail/send
    ‚îÇ       ‚Üì
    ‚îÇ       Update notifications/{id}: status='sent', sentAt=NOW
    ‚îÇ
    ‚îî‚îÄ Push:
        ‚îî‚îÄ Firebase Cloud Messaging: POST /send
            ‚Üì
            Update notifications/{id}: status='sent', sentAt=NOW

If error:
    ‚îÇ Update notifications/{id}: status='failed', error=message
    ‚îÇ Retry logic (exponential backoff, max 3 attempts)
```

## 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 5.1. Twilio (SMS)
```typescript
// Firebase Function environment config
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=***
TWILIO_PHONE_NUMBER=+420...
```

### 5.2. SendGrid (Email)
```typescript
SENDGRID_API_KEY=SG...
SENDGRID_FROM_EMAIL=notifications@zabicekiosk.cz
```

### 5.3. Firebase Cloud Messaging (Push)
- –ò—Å–ø–æ–ª—å–∑—É–µ–º Firebase Admin SDK (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- FCM —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `users/{userId}/fcmTokens` (–º–∞—Å—Å–∏–≤)

## 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 6.1. Authentication
- API endpoints —Ç—Ä–µ–±—É—é—Ç Firebase Auth —Ç–æ–∫–µ–Ω
- Only authenticated users can update own preferences

### 6.2. Firestore Security Rules
```javascript
match /notificationPreferences/{userId} {
  allow read, write: if request.auth.uid == userId;
}

match /notifications/{notificationId} {
  allow read: if request.auth.uid == resource.data.recipientId
              || hasRole('admin');
  allow write: if hasRole('admin');
}
```

### 6.3. Secrets Management
- Environment variables —á–µ—Ä–µ–∑ Firebase Functions config
- NEVER commit API keys to git
- Rotate credentials quarterly

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 7.1. Unit Tests
- Template interpolation logic
- Retry logic
- Error handling

### 7.2. Integration Tests
- Mock Twilio/SendGrid responses
- Test Firestore triggers
- Test scheduling logic

### 7.3. E2E Tests (Playwright)
- Parent receives notification (check test SMS)
- Admin sees notification badge
- User can disable notifications

## 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Metrics
- Notification send rate (per minute)
- Delivery success rate (sent / total)
- Error rate by provider (Twilio vs SendGrid vs FCM)
- Average delivery time

### Alerts
- Error rate > 5% (15 min window)
- Queue backlog > 100 pending
- Provider API downtime

### Logs (Structured)
```typescript
logger.info('Notification sent', {
  notificationId,
  type: 'sms',
  recipientId,
  duration: 1234, // ms
  provider: 'twilio'
});
```

## 9. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Phase 1: Email —Ç–æ–ª—å–∫–æ (–Ω–µ–¥–µ–ª—è 1)
- Deploy notification-service (email only)
- Deploy notificationPreferences UI in parent-web
- Test with real users (opt-in beta)

### Phase 2: SMS (–Ω–µ–¥–µ–ª—è 2)
- Add Twilio integration
- Enable SMS in preferences UI
- Monitor costs ($0.05 per SMS)

### Phase 3: Push (–Ω–µ–¥–µ–ª—è 3)
- Implement FCM token collection
- Deploy push notification service
- Test on parent-web (browser push)

### Phase 4: Scheduler (–Ω–µ–¥–µ–ª—è 4)
- Deploy notification-scheduler function
- Enable Cloud Scheduler
- Monitor for 1 week before full rollout

## 10. –°—Ç–æ–∏–º–æ—Å—Ç—å

### Estimated Monthly Cost (1000 notifications/day)
- Firebase Functions: ~$5 (invocations)
- Firestore: ~$2 (reads/writes)
- Twilio SMS: ~$1500 (30k SMS √ó $0.05)
- SendGrid: $0 (free tier 100 emails/day)
- FCM: $0 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

**Total**: ~$1507/month

### Cost Optimization
- Batch email sends (reduce SendGrid API calls)
- Cache templates in memory
- Only send SMS for high-priority (default to push/email)

## 11. Roadmap

### Future Enhancements
- [ ] In-app notification center (admin-portal)
- [ ] A/B testing notification templates
- [ ] Rich push notifications (images, actions)
- [ ] Multi-language support (cs/en)
- [ ] WhatsApp integration (Twilio API)

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. Review —ç—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –∫–æ–º–∞–Ω–¥–æ–π
2. –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ `.backlog/pending/` –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
3. –ù–∞—á–∞—Ç—å —Å Phase 1 (email-only MVP)
```

---

## üöÄ –ö–∞–∫ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–±–æ—Ç—É lean-architect

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ Claude Code:
```
–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π [–æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞]
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –∑–∞–¥–∞—á—É
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.backlog/draft/my-architecture.md` –∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ:
```
–û–±—Ä–∞–±–æ—Ç–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑ .backlog/draft/my-architecture.md
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –§–æ—Ä–º–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞
–°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É –≤ `.backlog/pending/` –ø–æ —à–∞–±–ª–æ–Ω—É –∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ:
```
–û–±—Ä–∞–±–æ—Ç–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ –±—ç–∫–ª–æ–≥–∞
```

---

## üìö –ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç lean-architect?

### –¢–∏–ø–∏—á–Ω—ã–µ deliverables:
1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç** (`docs/architecture/[feature]-architecture.md`)
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
   - –î–∏–∑–∞–π–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
   - –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
   - –î–∏–∞–≥—Ä–∞–º–º—ã
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü–ª–∞–Ω —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

2. **ADR** (`docs/architecture/adr/ADR-XXX-[decision].md`)
   - –°—Ç–∞—Ç—É—Å —Ä–µ—à–µ–Ω–∏—è
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
   - –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
   - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

3. **OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è** (`services/*/openapi-[feature].yaml`)
   - Endpoints
   - Request/Response —Å—Ö–µ–º—ã
   - Authentication
   - Error responses

4. **–î–∏–∞–≥—Ä–∞–º–º—ã** (–≤ Markdown / Mermaid)
   - Sequence diagrams
   - Component diagrams
   - Data flow diagrams

---

## ‚ö†Ô∏è –ß—Ç–æ lean-architect –ù–ï –¥–µ–ª–∞–µ—Ç

‚ùå **–ù–µ –ø–∏—à–µ—Ç –∫–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**
‚Üí –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å typescript-engineer, react-engineer

‚ùå **–ù–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
‚Üí –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å database-engineer

‚ùå **–ù–µ –¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
‚Üí –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å devops

‚ùå **–ù–µ –ø–∏—à–µ—Ç —Ç–µ—Å—Ç—ã**
‚Üí –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å test-engineer

‚úÖ **Lean-architect —Ç–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç!**

---

## üí° –°–æ–≤–µ—Ç—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### 1. –ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã
‚ùå "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Å–∏—Å—Ç–µ–º—É"
‚úÖ "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å SMS, email, push –¥–ª—è zabicekiosk"

### 2. –£–∫–∞–∂–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
‚úÖ "–£—á—Ç–∏ –±—é–¥–∂–µ—Ç $100/–º–µ—Å—è—Ü –∏ –º–∞—Å—à—Ç–∞–± –¥–æ 10k –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"

### 3. –£–ø–æ–º—è–Ω–∏—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (–µ—Å–ª–∏ –≤–∞–∂–Ω–æ)
‚úÖ "–ò—Å–ø–æ–ª—å–∑—É–π Firebase Functions –∏ Twilio –¥–ª—è SMS"

### 4. –û–ø–∏—à–∏—Ç–µ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
‚úÖ "–†–æ–¥–∏—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 24 —á–∞—Å–∞ –¥–æ –∑–∞–Ω—è—Ç–∏—è"

### 5. –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã
‚úÖ "–ö–∞–∫–∏–µ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ real-time sync –º–µ–∂–¥—É kiosk –∏ admin?"

---

**–ü–æ–º–Ω–∏—Ç–µ**: lean-architect —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–∞–Ω–¥–µ–º–µ —Å –¥—Ä—É–≥–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏.
–°–Ω–∞—á–∞–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Üí –ø–æ—Ç–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –ø–æ—Ç–æ–º —Ç–µ—Å—Ç—ã ‚Üí –ø–æ—Ç–æ–º –¥–µ–ø–ª–æ–π. üèóÔ∏è‚Üí‚öôÔ∏è‚Üí‚úÖ‚ÜíüöÄ

**–°–æ–∑–¥–∞–Ω–æ**: 2025-11-03
**–§–∞–π–ª**: `.backlog/draft/LEAN-ARCHITECT-EXAMPLES.md`
